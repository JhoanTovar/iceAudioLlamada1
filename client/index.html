<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Web - Cliente ICE</title>
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/message-style.css">
    
    <!-- Cargar Ice.js -->
    <script src="./node_modules/ice/lib/Ice.js"></script>
    <script src="Player.js"></script>

</head>
<body>
<div id="app">
    <!-- Login Screen -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <h1>Chat-JJJ</h1>
                <p>Parcháte De Una Con Tus Amigos</p>
            </div>
            <div class="login-form">
                <input type="text" id="username-input" placeholder="Nombre de usuario" autocomplete="username">
                <div class="login-buttons">
                    <button id="login-btn" class="btn btn-primary btn-block">Iniciar Sesión</button>
                    <button id="register-btn" class="btn btn-secondary btn-block">Crear Cuenta</button>
                </div>
                <div id="login-error" class="error-message"></div>
            </div>
        </div>
    </div>

    <!-- Main Chat Screen -->
    <div id="chat-screen" class="screen">
        <div class="chat-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <div class="user-info">
                        <div class="user-avatar"></div>
                        <div class="user-details">
                            <span id="current-username" class="username"></span>
                            <span class="status-text">En línea</span>
                        </div>
                    </div>
                    <button id="logout-btn" class="btn-icon" title="Cerrar sesión">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </button>
                </div>

                <div class="sidebar-search">
                    <input type="text" id="search-input" placeholder="Buscar..." class="search-box">
                </div>

                <div class="sidebar-tabs">
                    <button class="tab-btn active" data-tab="chats">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Chats
                    </button>
                    <button class="tab-btn" data-tab="groups">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Grupos
                    </button>
                </div>

                <div class="sidebar-content">
                    <!-- Chats Tab -->
                    <div id="chats-tab" class="tab-content active">
                        <div class="section-header">
                            <h3>Usuarios Disponibles</h3>
                            <button id="refresh-users-btn" class="btn-icon small" title="Actualizar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="23 4 23 10 17 10"></polyline>
                                    <polyline points="1 20 1 14 7 14"></polyline>
                                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                                </svg>
                            </button>
                        </div>
                        <div id="users-list" class="list"></div>
                    </div>

                    <!-- Groups Tab -->
                    <div id="groups-tab" class="tab-content">
                        <div class="section-header">
                            <h3>Mis Grupos</h3>
                            <button id="create-group-btn" class="btn-icon small" title="Crear grupo">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                        </div>
                        <div id="groups-list" class="list"></div>
                    </div>
                </div>
            </aside>

            <!-- Chat Area -->
            <main class="chat-main">
                <div id="welcome-screen" class="welcome-screen">
                    <div class="welcome-content">
                        <svg width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <h2>Bienvenido a Chat-JJJ</h2>
                        <p>Selecciona un usuario o grupo para comenzar a chatear</p>
                    </div>
                </div>

                <div id="chat-area" class="chat-area hidden">
                    <div class="chat-header">
                        <div class="chat-header-info">
                            <div class="chat-avatar"></div>
                            <div class="chat-header-text">
                                <h3 id="chat-title"></h3>
                                <span id="chat-subtitle" class="chat-subtitle"></span>
                            </div>
                        </div>
                        <div class="chat-header-actions">
                            <button id="group-info-btn" class="btn-icon" title="Info del grupo" style="display:none;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <path d="M12 17v4"></path>
                                    <path d="M12 3v4"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div id="messages-container" class="messages-container"></div>

                    <div class="chat-input-area">
                        <div class="input-wrapper">
                            <input type="text" id="message-input" placeholder="Escribe un mensaje..." autocomplete="off">
                            <button id="call-btn" class="btn-icon" title="Llamada de voz">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                </svg>
                            </button>
                            <button id="send-audio-btn" class="btn-icon" title="Enviar audio">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                    <line x1="12" y1="19" x2="12" y2="23"></line>
                                    <line x1="8" y1="23" x2="16" y2="23"></line>
                                </svg>
                            </button>
                            <button id="send-btn" class="btn btn-send">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div id="recording-indicator" class="recording-indicator hidden">
                        <div class="recording-dot"></div>
                        <span id="recording-time">0:00</span>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>

<!-- Create Group Modal -->
<div id="create-group-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Crear Nuevo Grupo</h3>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Nombre del grupo</label>
                <input type="text" id="group-name-input" placeholder="Ej: Amigos de la Universidad" autocomplete="off">
            </div>
            <div id="group-error" class="error-message"></div>
        </div>
        <div class="modal-footer">
            <button id="cancel-group-btn" class="btn btn-secondary">Cancelar</button>
            <button id="confirm-group-btn" class="btn btn-primary">Crear Grupo</button>
        </div>
    </div>
</div>

<!-- Add Members to Group Modal -->
<div id="add-members-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Agregar Miembros al Grupo</h3>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Selecciona usuarios para agregar</label>
                <div id="members-list" class="members-selection-list"></div>
            </div>
            <div id="members-error" class="error-message"></div>
        </div>
        <div class="modal-footer">
            <button id="cancel-members-btn" class="btn btn-secondary">Cancelar</button>
            <button id="confirm-members-btn" class="btn btn-primary">Agregar</button>
        </div>
    </div>
</div>

<!-- Incoming Call Modal -->
<div id="incoming-call-modal" class="modal call-modal">
    <div class="modal-content call-modal-content">
        <div class="call-info">
            <div class="call-avatar-large"></div>
            <h2 id="caller-name">Usuario</h2>
            <p id="call-status">Llamada entrante...</p>
        </div>
        <div class="call-actions">
            <button id="reject-call-btn" class="btn btn-danger">Rechazar</button>
            <button id="answer-call-btn" class="btn btn-success">Responder</button>
        </div>
    </div>
</div>

<!-- Active Call Modal -->
<div id="active-call-modal" class="modal call-modal">
    <div class="modal-content call-modal-content">
        <div class="call-info">
            <div class="call-avatar-large"></div>
            <h2 id="call-title">Usuario</h2>
            <p id="call-duration">0:00</p>
        </div>
        <div class="call-actions">
            <button id="end-call-btn" class="btn btn-danger">Terminar Llamada</button>
        </div>
    </div>
</div>


<!-- Modal de Grabación de Audio -->
<div id="recording-modal" class="modal">
  <div class="modal-content recording-modal-content">
    <div class="recording-modal-header">
      <div class="recording-indicator-large">
        <div class="recording-dot-large"></div>
        <span id="recording-modal-time">0:00</span>
      </div>
    </div>
    
    <div class="recording-modal-body">
      <div class="recording-icon">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
          <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
          <line x1="12" y1="19" x2="12" y2="23"></line>
          <line x1="8" y1="23" x2="16" y2="23"></line>
        </svg>
      </div>
      <p class="recording-text">Grabando mensaje de audio...</p>
      <p class="recording-hint" id="recording-chat-type">Chat individual</p>
    </div>
    
    <div class="recording-modal-footer">
      <button id="cancel-recording-btn" class="btn-cancel-recording">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Cancelar
      </button>
      <button id="stop-recording-btn" class="btn-stop-recording">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M9 9l6 3-6 3V9z"></path>
        </svg>
        Enviar
      </button>
    </div>
  </div>
</div>



<!-- Scripts -->
 
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="src/js/api.js"></script>

<!-- ES Modules -->
<script type="module" src="src/services/IceDelegate.js"></script>

<script src="src/js/audio-manager.js"></script>
<script src="src/js/ui.js"></script>
<script src="src/js/app.js"></script>
</body>
</html>